{"version":3,"file":"loadNodeTexture.js","sources":["../../src/adapter/loadNodeTexture.ts"],"sourcesContent":["import canvasModule from 'canvas';\nimport { extensions, ExtensionType, Texture, settings, utils } from 'pixijs/core';\nimport { NodeCanvasElement } from './NodeCanvasElement';\n\nimport type { CanvasRenderingContext2D } from 'canvas';\nimport type { LoadAsset, LoaderParser } from 'pixijs/assets';\nimport type { ICanvas } from 'pixijs/core';\n\nconst { loadImage } = canvasModule;\nconst validImages = ['.jpg', '.png', '.jpeg', '.svg'];\nconst validMimes = ['image/png', 'image/jpg', 'image/jpeg', 'image/svg'];\n\nfunction isSupportedDataURL(url: string): boolean\n{\n    const match = url.match(/^data:([^;]+);base64,/);\n\n    if (!match) return false;\n\n    const mimeType = match[1];\n\n    return validMimes.includes(mimeType);\n}\n\n/** loads our textures into a node canvas */\nexport const loadNodeTexture = {\n    extension: ExtensionType.LoadParser,\n\n    test(url: string): boolean\n    {\n        return validImages.includes(utils.path.extname(url)) || isSupportedDataURL(url);\n    },\n\n    async load(url: string, asset: LoadAsset): Promise<Texture>\n    {\n        const data = await settings.ADAPTER.fetch(url);\n        const image = await loadImage(Buffer.from(await data.arrayBuffer()));\n        const canvas = new NodeCanvasElement(image.width, image.height);\n        const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n        ctx.drawImage(image, 0, 0);\n        const texture = Texture.from(canvas as unknown as ICanvas, {\n            resolution: utils.getResolutionOfUrl(url),\n            ...asset.data\n        });\n\n        return texture;\n    },\n\n    unload(texture: Texture): void\n    {\n        texture.destroy(true);\n    }\n} as LoaderParser<Texture>;\n\nextensions.add(loadNodeTexture);\n"],"names":["canvasModule","ExtensionType","utils","settings","NodeCanvasElement","Texture","extensions"],"mappings":";;;;;;;;;;;;AAQA,MAAM,EAAE,SAAc,EAAA,GAAAA,gCAAA,CAAA;AACtB,MAAM,WAAc,GAAA,CAAC,MAAQ,EAAA,MAAA,EAAQ,SAAS,MAAM,CAAA,CAAA;AACpD,MAAM,UAAa,GAAA,CAAC,WAAa,EAAA,WAAA,EAAa,cAAc,WAAW,CAAA,CAAA;AAEvE,SAAA,kBAAA,CAA4B,GAC5B,EAAA;AACI,EAAM,MAAA,KAAA,GAAQ,GAAI,CAAA,KAAA,CAAM,uBAAuB,CAAA,CAAA;AAE/C,EAAA,IAAI,CAAC,KAAA;AAAO,IAAO,OAAA,KAAA,CAAA;AAEnB,EAAA,MAAM,WAAW,KAAM,CAAA,CAAA,CAAA,CAAA;AAEvB,EAAO,OAAA,UAAA,CAAW,SAAS,QAAQ,CAAA,CAAA;AACvC,CAAA;AAGO,MAAM,eAAkB,GAAA;AAAA,EAC3B,WAAWC,kBAAc,CAAA,UAAA;AAAA,EAEzB,KAAK,GACL,EAAA;AACI,IAAO,OAAA,WAAA,CAAY,SAASC,UAAM,CAAA,IAAA,CAAK,QAAQ,GAAG,CAAC,CAAK,IAAA,kBAAA,CAAmB,GAAG,CAAA,CAAA;AAAA,GAClF;AAAA,EAEA,MAAM,IAAK,CAAA,GAAA,EAAa,KACxB,EAAA;AACI,IAAA,MAAM,IAAO,GAAA,MAAMC,aAAS,CAAA,OAAA,CAAQ,MAAM,GAAG,CAAA,CAAA;AAC7C,IAAM,MAAA,KAAA,GAAQ,MAAM,SAAU,CAAA,MAAA,CAAO,KAAK,MAAM,IAAA,CAAK,WAAY,EAAC,CAAC,CAAA,CAAA;AACnE,IAAA,MAAM,SAAS,IAAIC,mCAAA,CAAkB,KAAM,CAAA,KAAA,EAAO,MAAM,MAAM,CAAA,CAAA;AAC9D,IAAM,MAAA,GAAA,GAAM,MAAO,CAAA,UAAA,CAAW,IAAI,CAAA,CAAA;AAElC,IAAI,GAAA,CAAA,SAAA,CAAU,KAAO,EAAA,CAAA,EAAG,CAAC,CAAA,CAAA;AACzB,IAAM,MAAA,OAAA,GAAUC,YAAQ,CAAA,IAAA,CAAK,MAA8B,EAAA;AAAA,MACvD,UAAA,EAAYH,UAAM,CAAA,kBAAA,CAAmB,GAAG,CAAA;AAAA,MACxC,GAAG,KAAM,CAAA,IAAA;AAAA,KACZ,CAAA,CAAA;AAED,IAAO,OAAA,OAAA,CAAA;AAAA,GACX;AAAA,EAEA,OAAO,OACP,EAAA;AACI,IAAA,OAAA,CAAQ,QAAQ,IAAI,CAAA,CAAA;AAAA,GACxB;AACJ,EAAA;AAEAI,eAAA,CAAW,IAAI,eAAe,CAAA;;;;"}